# 血容血温监测传感器部件软件单元测试计划
> [如何编写高质量的单片机软件单元测试报告？5个关键步骤详解](https://ones.com.cn/knowledge/how-to-write-high-quality-mcu-software-unit-test-report)
> [嵌入式软件测试工具和测试方法](https://www.cnblogs.com/Tommmy/articles/19063081)
> [如何测试嵌入式软件](https://docs.pingcode.com/baike/2828430)
> [嵌入式测试太难？7个嵌入式测试工具推荐](https://blog.csdn.net/m0_56736369/article/details/139533440)

---
gcovr -r . --html --html-details -o build/artifacts/gcov/index.html
ceedling test:all
ceedling gcov:all

---
## 1. 文档信息

|   项目   |             内容              |
| -------- | ----------------------------- |
| 项目名称 | 血容血温监测传感器软件单元测试 |
| 版本     | v1.0                          |
| 创建日期 | 2025-12-08                    |
| 创建人   | 刘振                          |

## 2. 测试概述

### 2.1 测试目的
验证血容血温监测传感器部件软件各功能模块的正确性、稳定性和可靠性。

### 2.2 测试范围
|   测试模块   |             测试内容              |
| ------------ | --------------------------------- |
| 治疗流程模块 | 观察按键指示灯,屏幕是否按照流程执行  |
| 数据采集模块 | THS传感器数据读取、采集频率控制     |
| 数据处理模块 | 采集数据滤波、RBV计算、数据格式转换 |
| 数据存储模块 | 本地存储、U盘导出                  |
| 数据传输模块 | RJ45网络通信、WiFi通信             |
| 配置管理模块 | 设备配置导入读取                   |

### 2.3 测试环境
| 环境类型 |              配置要求               |
| -------- | ---------------------------------- |
| 开发环境 | KEIL                               |
| 测试框架 | Ceedling, Unity, Cmoke, CException |
| 操作系统 | Windows10                          |

## 3. 软件模块单元测试

### 3.1 传感器处理单元测试

#### 3.1.1 数据采集与处理测试

| 测试项 | 测试目标 | 测试方法 | 通过标准 |
|--------|----------|----------|----------|
| **UC-SP-001** | 验证采集数据的滤波处理功能 | 1. 向处理单元输入一组包含随机波动和毛刺的仿真传感器数据<br>2. 启动数据处理流程 | 1. 输出的HCT及温度数据曲线平滑，无明显不合理跳变<br>2. 滤波后的数据符合预设的算法逻辑 |
| **UC-SP-002** | 验证HCT到RBV的格式转换计算 | 1. 输入一个当前的HCT(t)仿真值（如：25%）<br>2. 触发一次计算 | RBV(t)计算结果为 (30-25)/25 = 20.0%，计算准确 |
| **UC-SP-003** | 验证数据填充为XML文本的格式正确性 | 1. 调用数据传输接口，准备发送数据<br>2. 捕获待传输的数据文本 | 1. 数据被封装为格式良好的XML片段<br>2. XML中包含正确的标签、时间戳、RBV值、温度值，且值无误 |

### 3.2 传感器采集单元测试

#### 3.2.1 THS传感器数据读取测试

| 测试项 | 测试目标 | 测试方法 | 通过标准 |
|--------|----------|----------|----------|
| **UC-SC-001** | 验证USB2.0协议与THS模块的适配性 | 1. 上电启动系统<br>2. 检查软件日志与状态 | 1. 系统能正确识别并挂载THS模块<br>2. 日志显示USB通讯协议握手成功，无报错 |
| **UC-SC-002** | 验证默认30秒/次数据读取频率的准确性 | 1. 记录首次成功读取数据的时间戳T0<br>2. 连续监测并记录后续至少5次数据读取的时间戳 | 1. 每次数据读取间隔为30±1秒<br>2. 读取动作稳定，无长时间阻塞或漏读 |
| **UC-SC-003** | 验证THS模块断开或数据异常的容错处理 | 1. 在两次读取之间，物理断开THS模块连接<br>2. 观察系统状态与日志<br>3. 重新连接模块 | 1. 系统检测到断开，触发"异常"状态，黄灯闪烁<br>2. 系统不应崩溃，应持续尝试恢复或等待<br>3. 重新连接后，能自动恢复正常读取 |

### 3.3 数据存储单元测试

#### 3.3.1 本地数据存储测试

|     测试项     |              测试目标               |                                         测试方法                                         |                                                      通过标准                                                      |
| ------------- | ---------------------------------- | --------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ |
| **UC-DS-001** | 验证.csv格式存储的数据正确性与完整性 | 1. 启动一次治疗流程，产生多组数据<br>2. 治疗结束后，检查存储的.csv文件                      | 1. 文件生成，格式为.csv<br>2. 文件包含所有指定列：UID、日期、时间、血温、血容量(RBV)<br>3. 每条记录数据与当时产生值一致 |
| **UC-DS-002** | 验证至少2周数据存储的容量            | 1. 模拟连续不断(24小时/天)产生数据(如30秒/次)<br>2. 快速写入模拟数据持续写入超过2周(如15天) | 1. 系统在整个过程中持续正常运行，无因存储满而异常<br>2. 15天后，最早的数据仍可访问，存储容量满足要求                    |
| **UC-DS-003** | 验证RTC时钟在电池供电下的同步准确性  | 1. 记录当前准确时间T1<br>2. 断开主电源，静置24小时<br>3. 重新上电，读取系统时间T2           | 系统时间T2与T1+24小时的误差在允许范围内(如±1分钟)，证明RTC电池维持时钟有效                                             |
| **UC-DS-004** | 验证存储满后的数据处理策略           | 1. 继续产生并存储新数据，直至触发存储满状态<br>2. 观察系统行为与日志                        | 1. 系统应按照预定策略(如覆盖最旧数据)处理，或抛出明确警告但不停机<br>2. 策略执行后，新数据可继续写入                    |

### 3.4 数据传输单元测试

#### 3.4.1 RJ45网络通信测试

| 测试项 | 测试目标 | 测试方法 | 通过标准 |
|--------|----------|----------|----------|
| **UC-DT-001** | 验证RJ45接口与第三方系统通讯符合规范 | 1. 在PCBA上产生一组测试数据<br>2. 启动数据传输<br>3. 在第三方系统模拟器端监听并捕获数据 | 1. 第三方系统成功接收到数据<br>2. 数据格式、内容、协议(符合BB-DCI V2.1)完全正确 |

#### 3.4.2 USB-serial接口测试

| 测试项 | 测试目标 | 测试方法 | 通过标准 |
|--------|----------|----------|----------|
| **UC-DT-002** | 验证USB-serial接口U盘导出功能 | 1. 触发"数据导出"指令(如通过按键或指令)<br>2. 等待导出完成，检查U盘内容 | 1. U盘根目录生成包含历史数据的.csv文件<br>2. 文件可通过电脑正常打开，数据完整<br>3. 导出过程指示灯或日志状态正确 |

#### 3.4.3 Wi-Fi通信测试

| 测试项 | 测试目标 | 测试方法 | 通过标准 |
|--------|----------|----------|----------|
| **UC-DT-003** | 验证Wi-Fi模块与三方系统/外屏的数据传输 | 1. 配置PCBA向指定IP/端口发送数据<br>2. 在PCBA产生实时数据<br>3. 在接收端查看 | 1. 接收端能持续、稳定地收到实时RBV和温度数据<br>2. 数据传输延迟在可接受范围内，无频繁断连 |

### 3.5 配置管理单元测试

#### 3.5.1 设备配置测试

|     测试项     |           测试目标            |                                         测试方法                                          |                                               通过标准                                                |
| ------------- | ----------------------------- | ----------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------- |
| **UC-CM-001** | 验证通过U盘写入配置(UID、时间) | 1. 插入U盘，给系统上电<br>2. 观察启动过程中指示灯状态(应蓝闪)<br>3. 启动完成后，检查系统配置  | 1. 系统识别U盘配置文件，进入配置模式(蓝闪)<br>2. 启动后，系统UID、日期时间变为配置文件中的值，状态灯蓝常亮 |
| **UC-CM-002** | 验证配置文件识别与解析的准确性 | 1. 通过U盘发送配置信息(UID=Test01, 时间=2025-01-01 10:00:00)<br>2. 检查系统生效的配置       | 1. 系统能准够确解析配置文件或指令<br>2. 解析后，系统获取的UID和时间值与发送值完全一致                     |
| **UC-CM-003** | 验证错误配置数据的处理逻辑      | 1. 通过U盘写入一份格式错误(如JSON错误)或内容非法(如时间格式不对)的配置文件<br>2. 观察系统反应 | 1. 系统应拒绝错误配置，进入安全状态(如使用默认配置或上次有效配置)<br>2. 在日志中记录明确的配置错误信息     |

### 3.6 治疗流程单元测试

#### 3.6.1 状态指示灯测试

|     测试项     |             测试目标             |                                                   测试方法                                                   |                                                                            通过标准                                                                            |
| ------------- | ------------------------------- | ------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UC-TP-001** | 验证完整治疗流程状态指示灯序列    | 1. 接通电源<br>2. 插入已配置U盘<br>3. 等待配置完成，按下"开始治疗"键<br>4. 等待10分钟以上<br>5. 按下"结束治疗"键 | 1. 通电后：**白灯常亮**<br>2. 识别U盘配置：**蓝灯闪烁**→配置成功：**蓝灯常亮**<br>3. 按键开始：**绿灯闪烁**→10分钟后：**绿灯常亮**<br>4. 按键结束：**所有灯熄灭** |
| **UC-TP-002** | 验证THS故障时的异常状态指示       | 1. 模拟THS故障(如断开传感器连接)                                                                              | 系统检测到THS故障，状态指示灯变为**黄灯闪烁**，直至故障排除                                                                                                       |
| **UC-TP-003** | 验证网络/信号故障时的异常状态指示 | 1. 断开Wi-Fi路由器或制造强信号干扰                                                                            | 系统检测到网络不可用，状态指示灯变为**黄灯常亮**，直至网络恢复                                                                                                    |

### 3.7 屏幕显示单元测试

#### 3.7.1 显示功能测试

|     测试项     |             测试目标             |                             测试方法                              |                                                      通过标准                                                       |
| ------------- | -------------------------------- | ----------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------- |
| **UC-DU-001** | 验证彩色TFT屏数据与状态显示准确性 | 1. 使系统处于不同状态(如治疗中、联机、拷贝中)<br>2. 观察屏幕显示内容 | 1. 实时显示的血液温度(℃)、RBV(%)、日期时间准确<br>2. 联机状态、板子状态图标与文字指示正确<br>3. 整体显示清晰，1米内可见 |
| **UC-DU-002** | 验证数据拷贝与固件升级进度条显示   | 1. 触发U盘数据拷贝操作                                             | 1. 屏幕显示拷贝动态进度条进度与实际进程同步                                                                           |
| **UC-DU-003** | 验证开机软件版本单次显示          | 1. 给系统上电开机                                                  | 开机启动过程中，屏幕在主界面出现前，单次显示当前软件版本号(如V1.0.0)，持续约3秒后进入主界面                              |

## 4 稳定性测试
|    测试项    |       测试目标       |      测试方法      |      通过标准      |
| ----------- | ------------------- | ----------------- | ----------------- |
| TC-PERF-001 | 验证长时间运行稳定性 | 连续运行24小时     | 无内存泄漏、无死机 |
| TC-PERF-002 | 验证高负载处理能力   | 模拟高频率数据输入 | 系统稳定性良好     |


## 6. 测试通过标准

### 6.1 质量门禁
| 检查项 | 要求 | 状态 |
|--------|------|------|
| 单元测试代码覆盖率 | ≥90% | [ ] |
| 测试用例执行率 | 100% | [ ] |
| 严重级别缺陷解决率 | 100% | [ ] |
| 性能指标达标率 | 100% | [ ] |
| 安全测试通过率 | 100% | [ ] |

### 6.2 验收标准
| 检查项 | 要求 | 状态 |
|--------|------|------|
| 所有需求功能验证 | 通过 | [ ] |
| 用户验收测试 | 签字确认 | [ ] |
| 测试报告评审 | 通过 | [ ] |
| 问题跟踪单 | 全部关闭 | [ ] |

## 8. 测试报告


### 8.1 测试总结报告
|     项目     |           内容            |
| ------------ | ------------------------ |
| 测试周期     | YYYY-MM-DD 至 YYYY-MM-DD |
| 测试轮次     | {轮次数量}                |
| 执行用例总数 | {总数量}                  |
| 通过用例数   | {通过数量}                |
| 失败用例数   | {失败数量}                |
| 测试通过率   | {百分比}%                 |

#### 缺陷统计
| 严重级别 | 数量 | 解决数量 | 遗留数量 |
|----------|------|----------|----------|
| 严重 | {数量} | {数量} | {数量} |
| 一般 | {数量} | {数量} | {数量} |
| 轻微 | {数量} | {数量} | {数量} |

